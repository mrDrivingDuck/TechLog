# DBMS - Two Pass Hashing Query

Created by : Mr Dk.

2019 / 12 / 20 20:14

Nanjing, Jiangsu, China

---

基于散列的两趟算法

---

## 通过散列划分关系

将 __每一个桶__ 和 __一个缓冲区__ 联系起来 (共 `M-1` 个)

最后一个缓冲区用于每次一块地装入关系 R

如果缓冲区已满，就将其写入磁盘，并重新初始化为新的缓冲区

对每个桶的最后一块，如果不为空，就写回磁盘

---

## 基于散列的消除重复算法

将关系 R 散列到 `M-1` 个桶中

* 散列函数的参数为 R 的一个元组整体
* 这样相同的元组将会被散列到一个桶中

一次检查一个桶，在桶中独立执行 `δ`

将 `δ` 的并作为最终结果

条件 - 每个桶中的元组能够被装入内存执行一趟算法

* 假设桶中的元素个数为 `B(R)/(M-1)`
* 那么 `B(R)/(M-1) ≤ M` 才行
* 即，保守估计为 `B(R) ≤ M^2`

磁盘 I/O 代价: 读入内存分桶 + 写回磁盘 (2B(R)) + 读入内存一趟去重 (B(R)) = 3B(R)

---

## 基于散列的分组和聚集算法

对于 `γ` 操作

第一趟也是将所有元组散列到 `M-1` 个桶中

* 散列函数基于分组属性

在第二趟中，用一趟算法分别处理每一个桶中的元组

条件和代价与上面的算法相同

---

## 基于散列的并、交、差算法

保证使用相同的散列算法对两个关系的元组进行计算

将 R 和 S 各自散列到 `M-1` 个桶

对每一对桶使用适当的一趟算法

代价: `3(B(R) + B(S))`

条件要求较小的操作对象至多占用 `M-1` 个块

因此近似要求 `min(B(R), B(S)) ≤ M^2`

---

## 散列连接算法

计算 `R(X, Y)` 和 `S(Y, Z)` 的连接

用连接属性 Y 作为散列关键字

将 R 和 S 散列为相同数量的桶中

* 两个能被连接的元组一定会出现在 R 和 S 对应的桶中
* 对每一对桶中的元组进行一趟连接

代价: `3(B(R) + B(S))`

条件: `min(B(R), B(S)) ≤ M^2`

每一对桶中，至少有一个桶能全部装入 `M-1` 个缓冲区中

---

## Summary

基于排序的算法和基于散列的算法，在条件需求上几乎相同

* 基于排序的算法，依赖于两个操作对象大小之和
* 基于索引的算法，依赖于两个操作对象中较小的那个

---

